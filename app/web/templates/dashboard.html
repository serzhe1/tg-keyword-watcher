{% extends "base.html" %}
{% block title %}{{ t("dashboard.title", lang) }} Â· tg-keyword-watcher{% endblock %}

{% block content %}
<h1 class="h1">{{ t("dashboard.title", lang) }}</h1>

<div class="grid">
    <div class="card">
        <div class="card__title">{{ t("dashboard.status", lang) }}</div>

        <div class="kv">
            <div class="kv__row">
                <div class="kv__k">{{ t("dashboard.connected", lang) }}</div>
                <div class="kv__v">
                    {% if connected == 'YES' %}
                    <span class="badge badge--ok">YES</span>
                    {% else %}
                    <span class="badge badge--bad">NO</span>
                    {% endif %}
                </div>
            </div>

            <div class="kv__row">
                <div class="kv__k">{{ t("dashboard.bot_enabled", lang) }}</div>
                <div class="kv__v">
                    {% if bot_enabled == 'YES' %}
                    <span class="badge badge--ok">YES</span>
                    {% else %}
                    <span class="badge badge--warn">NO</span>
                    {% endif %}
                </div>
            </div>

            <div class="kv__row">
                <div class="kv__k">{{ t("dashboard.target", lang) }}</div>
                <div class="kv__v">{{ target_channel }}</div>
            </div>

            <div class="kv__row">
                <div class="kv__k">{{ t("dashboard.session", lang) }}</div>
                <div class="kv__v">{{ session_name }}</div>
            </div>

            <div class="kv__row">
                <div class="kv__k">{{ t("dashboard.server_time", lang) }}</div>
                <div class="kv__v">{{ server_time_utc }}</div>
            </div>
        </div>

        <div class="space"></div>

        <div class="card__title">{{ t("dashboard.controls", lang) }}</div>
        <div class="controls">
            <form method="post" action="/controls/enable">
                <button class="btn btn--primary" type="submit">{{ t("dashboard.enable", lang) }}</button>
            </form>
            <form method="post" action="/controls/disable">
                <button class="btn" type="submit">{{ t("dashboard.disable", lang) }}</button>
            </form>
            <form method="post" action="/controls/restart">
                <button class="btn" type="submit">{{ t("dashboard.restart", lang) }}</button>
            </form>
            <form method="post" action="/controls/cleanup">
                <button class="btn" type="submit">{{ t("dashboard.cleanup", lang) }}</button>
            </form>
        </div>
        <div class="muted small">{{ t("dashboard.restart_hint", lang) }}</div>
    </div>

    <div class="card">
        <div class="card__title">{{ t("dashboard.last_error", lang) }}</div>
        {% if last_error %}
        <div class="mono pre">{{ last_error }}</div>
        {% else %}
        <div class="muted">{{ t("dashboard.no_errors", lang) }}</div>
        {% endif %}

        <div class="space"></div>

        <div class="card__title">{{ t("dashboard.last_event", lang) }}</div>
        {% if last_event_time %}
        <div class="muted small">{{ last_event_time }}</div>
        <div class="mono pre">{{ last_event_message }}</div>
        {% else %}
        <div class="muted">{{ t("dashboard.no_events", lang) }}</div>
        {% endif %}
    </div>
</div>
{% endblock %}
