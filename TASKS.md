Не используй amplicode, также после решения пиши commit message, чтобы я смог закомитить, например T5.2: Backfill messages after checkpoint on reconnect
# TASKS
- [x] T0.1: Создать структуру проекта
  Что сделать:
  - Базовый каркас приложения: `app/`, `app/main.py`, `app/web/`, `app/db/`, `app/bot/`.
  - Базовые зависимости в `requirements.txt` для FastAPI, Telethon, asyncpg, Jinja2, uvicorn.
  - Dockerfile для Python 3.12.
  Результат:
  - Проект собирается в контейнер и поднимается пустым приложением.
  Как тестировать:
  - `docker compose up --build` и проверка `/health`.

- [x] T0.2: Настроить docker-compose
  Что сделать:
  - `docker-compose.yml` с сервисами `app` и `db`.
  - Том для `./data/session` -> `/app/session`.
  - Загрузка `.env` и прокидывание переменных.
  Результат:
  - `app` видит `.session`, `db` доступен из `app` по `DATABASE_URL`.
  Как тестировать:
  - `docker compose up` без ошибок, `app` стартует и коннектится к `db`.

- [x] T1.1: Создать SQL-миграции
  Что сделать:
  - SQL файлы для таблиц: `keywords`, `forwarded_messages`, `channel_checkpoint`, `event_log`, `bot_state`, `app_status`.
  - Индексы для `forwarded_messages` и `event_log`.
  Результат:
  - Миграции применяются при старте контейнера.
  Как тестировать:
  - Чистая БД + `docker compose up`.
  - Проверить наличие таблиц и индексов.

- [x] T1.2: Реализовать DB-слой
  Что сделать:
  - CRUD для `keywords`.
  - `forwarded_messages`: `claim`, `mark_sent`, `mark_failed` (атомарно).
  - `checkpoint` get/upsert.
  - `event_log` запись ошибок.
  - `bot_state`/`app_status` чтение и обновление.
  - `cleanup` по retention.
  Результат:
  - Антидублирование на уровне БД.
  Как тестировать:
  - Юнит/интеграционные проверки вызовов репозитория.
  - Повторный `claim` для одного сообщения не дает дубль.

- [x] T2.1: Реализовать аутентификацию
  Что сделать:
  - Login форма, проверка логина/пароля из env.
  - Cookie-сессия.
  - Без логина все страницы закрыты.
  Результат:
  - Нет доступа без логина.
  Как тестировать:
  - Открыть `/` без логина → редирект на `/login`.
  - Успешный логин → доступ к панелям.

- [x] T2.2: Dashboard
  Что сделать:
  - Показать `Connected`, `Last error`, `Last event time`, `Bot enabled`.
  - Кнопки `Enable`, `Disable`, `Restart`.
  Результат:
  - Кнопки управляют состоянием через БД.
  Как тестировать:
  - Нажать `Enable/Disable` → обновление состояния.
  - `Restart` → фиксируется `restart_requested_at`.

- [x] T2.3: Управление keywords
  Что сделать:
  - Список ключевых слов.
  - Добавление и удаление.
  Результат:
  - Изменения доступны боту сразу.
  Как тестировать:
  - Добавить слово, обновить список, удалить слово.

- [x] T2.4: Logs page
  Что сделать:
  - Страница логов с ошибками.
  - Максимум 100 записей, без деталей сообщений.
  Результат:
  - Админ видит причины ошибок.
  Как тестировать:
  - Сымитировать ошибку и убедиться, что она попала в логи.

- [x] T2.5: Cleanup
  Что сделать:
  - Кнопка `Cleanup` в админке.
  - Автоматический запуск раз в сутки.
  - Удаление логов старше 7 дней и forwarded старше 30 дней.
  Результат:
  - Старые данные очищаются.
  Как тестировать:
  - Создать тестовые записи со старой датой, выполнить cleanup, убедиться в удалении.

- [x] T3.1: Авторизация Telethon
  Что сделать:
  - Работа через `.session` файл.
  - Если не авторизован, `Connected = NO` и ошибка фиксируется.
  Результат:
  - Бот подключается только при валидной сессии.
  Как тестировать:
  - Удалить/испортить `.session` → `Connected=NO`.
  - Валидная `.session` → `Connected=YES`.

- [x] T3.2: Резолв целевого канала
  Что сделать:
  - Получить `target_chat_id` через `TARGET_CHANNEL` (invite link приоритет, затем `@username`).
  - Ошибки логируются в админке.
  Результат:
  - Бот всегда знает, куда пересылать сообщения.
  Как тестировать:
  - Указать неправильный `TARGET_CHANNEL` → ошибка.
  - Указать корректный → успешный резолв.

- [x] T3.3: Исключить целевой канал
  Что сделать:
  - Не мониторить `TARGET_CHANNEL`.
  - Не создавать checkpoint для него.
  - Не участвует в backfill.
  Результат:
  - Нет бесконечных циклов.
  Как тестировать:
  - Пост в `TARGET_CHANNEL` не обрабатывается ботом.

- [x] T3.4: Мониторинг каналов
  Что сделать:
  - Обработчик `events.NewMessage` для всех каналов и групп.
  - Использовать `event.is_channel` и `event.chat_id`.
  - Не вызывать `get_chat()` в live handler.
  Результат:
  - Новые посты стабильно ловятся.
  Как тестировать:
  - Написать в подписанный канал → фиксируется событие.

- [x] T4.1: Поиск ключевых слов
  Что сделать:
  - Поиск без учета регистра.
  - `е` == `ё`.
  - Поиск по подстроке.
  Результат:
  - `жен` ловит `жена`, `поженились`.
  Как тестировать:
  - Добавить ключевое слово `жен`, отправить текст `поженились`.

- [x] T4.2: Антидублирование
  Что сделать:
  - Уникальность: `(source_chat_id, source_message_id)`.
  - `pending -> retry` при таймауте.
  - `sent -> never`.
  Результат:
  - Один пост пересылается один раз.
  Как тестировать:
  - Смоделировать повторную обработку одного сообщения.
  - Убедиться, что повтор не переслан.

- [x] T4.3: Поведение при совпадении
  Что сделать:
  - Сначала отправить сообщение с найденными ключевыми словами.
  - Затем `forward` оригинального сообщения.
  Результат:
  - Всегда сохраняется порядок: текст → forward.
  Как тестировать:
  - Отправить тестовый пост с keyword и проверить порядок в целевом канале.

- [ ] T5.1: Первый запуск
  Что сделать:
  - Не читать всю историю.
  - Поставить checkpoint на последнее сообщение в канале.
  Результат:
  - Старые сообщения не пересылаются.
  Как тестировать:
  - Подписаться на канал с историей → старые не форвардятся.

- [ ] T5.2: Backfill после падения
  Что сделать:
  - Читать сообщения после checkpoint, постранично.
  - Обновлять checkpoint после обработки.
  Результат:
  - После рестарта сообщения не теряются.
  Как тестировать:
  - Остановить контейнер, создать новые посты, запустить → посты доставлены.

- [ ] T6.1: Restart
  Что сделать:
  - Кнопка Restart инициирует мягкий reconnect Telethon.
  - После рестарта выполняется backfill.
  Результат:
  - Бот восстанавливается без ручных действий.
  Как тестировать:
  - Нажать Restart в админке и убедиться в повторном подключении.

- [ ] T6.2: Ошибки
  Что сделать:
  - Любая фатальная ошибка записывается в `app_status.last_error` и `event_log`.
  Результат:
  - Админ видит причину сбоя.
  Как тестировать:
  - Сымитировать ошибку (например, неверный API ключ) и проверить отображение.

- [ ] T7.1: UI/UX адаптивность
  Что сделать:
  - Адаптивные стили для desktop и mobile.
  Результат:
  - UI корректно отображается на телефоне и ПК.
  Как тестировать:
  - Проверить в devtools на разных размерах экрана.

- [ ] T7.2: Навигация
  Что сделать:
  - Простые вкладки: Dashboard, Keywords, Logs, Docs.
  Результат:
  - Пользователь легко переключается между страницами.
  Как тестировать:
  - Перейти по всем страницам вручную.

- [ ] T8.1: Docs page
  Что сделать:
  - Документация для пользователей.
  Результат:
  - Новому сотруднику понятно, как управлять ботом.
  Как тестировать:
  - Проверить, что все пункты из ТЗ описаны.

- [ ] T9.1: Финальная проверка
  Что сделать:
  - Пройти тест-кейсы из ТЗ.
  Результат:
  - Все сценарии работают.
  Как тестировать:
  - Ручной прогон кейсов T9.1.
